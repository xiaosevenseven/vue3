{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/reactiveEffect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["\n\n//  \u521B\u5EFA\u4E00\u4E2A\u54CD\u5E94\u5F0F effect \u6570\u636E\u53D8\u5316\u540E\u53EF\u4EE5\u5728\u91CD\u65B0\u6267\u884C\nexport function effect(fn: Function, options: object = {}) {\n    const _effect = new ReactiveEffect(fn, () => {\n        _effect.run();\n    })\n    _effect.run();\n    return _effect;\n}\n\nexport let activeEffect: ReactiveEffect | undefined;\nclass ReactiveEffect {\n    public active = true;\n    constructor(public fn, public scheduler) { }\n    run() {\n        if (!this.active) {\n            // \u4E0D\u662F\u6FC0\u6D3B\u7684\uFF0C\u6267\u884C\u540E\u4EC0\u4E48\u90FD\u4E0D\u7528\u505A\n            return this.fn();\n        }\n        let lastEffect = activeEffect;\n        try {\n            // \u4F9D\u8D56\u6536\u96C6\n            activeEffect = this;\n            return this.fn();\n        } finally {\n            activeEffect = lastEffect;\n        }\n\n    }\n    stop() {\n        this.active = false;\n    }   \n}", "export const isObject = (val: any) => val !== null && typeof val === 'object';\n", "import { activeEffect } from \"./effect\"\n\nconst targetMap = new WeakMap();    // \u5B58\u50A8\u5BF9\u8C61\u548C\u5C5E\u6027\u7684\u4F9D\u8D56\u5173\u7CFB\n\nexport const createDep = (cleanup: Function) => {\n\n}\nexport function track(target: object, key: unknown) {\n\n    /**\n     * activeEffect \u5B58\u5728\u8BF4\u660E\u8FD9\u4E2A key \u662F\u5728 effect \u4E2D\u88AB\u4F7F\u7528\u7684\n     * \u4E0D\u5B58\u5728\uFF0C\u5219\u8BF4\u660E\u662F\u5728 effect \u5916\u88AB\u4F7F\u7528\u7684\uFF0C\u4E0D\u9700\u8981\u6536\u96C6\u4F9D\u8D56\n     */\n    if (activeEffect) {\n        console.log('track', activeEffect, target, key)\n\n        let depsMap = targetMap.get(target)\n        if (!depsMap) {\n            targetMap.set(target, (depsMap = new Map()))\n        }\n        let dep = depsMap.get(key)\n        if (!dep) {\n            depsMap.set(key,  createDep(() => depsMap.delete(key)))\n        }\n        console.log('targetMap', targetMap)\n    }\n}", "\nimport { track } from \"./reactiveEffect\"\n\nexport enum ReactiveFlags {\n    IS_REACTIVE = '__v_isReactive',\n    IS_READONLY = '__v_isReadonly',\n    IS_SHALLOW = '__v_isShallow'\n}\nexport const mutableHandlers: ProxyHandler<any> = {\n    get(target, key, receiver) {\n        if (key === ReactiveFlags.IS_REACTIVE) {\n            return true\n        }\n        track(target, key)\n        // \u6536\u96C6\u4F9D\u8D56\n        return Reflect.get(target, key, receiver)\n    },\n    set(target, key, value, receiver) {\n        // \u89E6\u53D1\u4F9D\u8D56\n        return Reflect.set(target, key, value, receiver)\n    }\n}\n", "import { isObject } from \"@vue/shared\"\nimport { mutableHandlers, ReactiveFlags } from \"./baseHandler\";\n\nconst reactiveMap = new WeakMap();\n\nexport function reactive(target: object) {\n    return createReactiveObject(target)\n}\n\nfunction createReactiveObject(target: object) {\n    // \u5982\u679C\u4E0D\u662F\u5BF9\u8C61\u76F4\u63A5\u8FD4\u56DE\n    if (!isObject(target)) {\n        return target\n    }\n    // \u5982\u679C\u5DF2\u7ECF\u4EE3\u7406\u8FC7\u4E86\uFF0C\u76F4\u63A5\u8FD4\u56DE\n    if (target[ReactiveFlags.IS_REACTIVE]) {\n        return target\n    }\n    const exitsProxy = reactiveMap.get(target)\n    if (exitsProxy) {\n        return exitsProxy\n    }\n    let proxy = new Proxy(target, mutableHandlers)\n    reactiveMap.set(target, proxy)\n    return proxy\n} "],
  "mappings": ";AAGO,SAAS,OAAO,IAAc,UAAkB,CAAC,GAAG;AACvD,QAAM,UAAU,IAAI,eAAe,IAAI,MAAM;AACzC,YAAQ,IAAI;AAAA,EAChB,CAAC;AACD,UAAQ,IAAI;AACZ,SAAO;AACX;AAEO,IAAI;AACX,IAAM,iBAAN,MAAqB;AAAA,EAEjB,YAAmB,IAAW,WAAW;AAAtB;AAAW;AAD9B,SAAO,SAAS;AAAA,EAC2B;AAAA,EAC3C,MAAM;AACF,QAAI,CAAC,KAAK,QAAQ;AAEd,aAAO,KAAK,GAAG;AAAA,IACnB;AACA,QAAI,aAAa;AACjB,QAAI;AAEA,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACnB,UAAE;AACE,qBAAe;AAAA,IACnB;AAAA,EAEJ;AAAA,EACA,OAAO;AACH,SAAK,SAAS;AAAA,EAClB;AACJ;;;ACjCO,IAAM,WAAW,CAAC,QAAa,QAAQ,QAAQ,OAAO,QAAQ;;;ACErE,IAAM,YAAY,oBAAI,QAAQ;AAEvB,IAAM,YAAY,CAAC,YAAsB;AAEhD;AACO,SAAS,MAAM,QAAgB,KAAc;AAMhD,MAAI,cAAc;AACd,YAAQ,IAAI,SAAS,cAAc,QAAQ,GAAG;AAE9C,QAAI,UAAU,UAAU,IAAI,MAAM;AAClC,QAAI,CAAC,SAAS;AACV,gBAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,IAC/C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,QAAI,CAAC,KAAK;AACN,cAAQ,IAAI,KAAM,UAAU,MAAM,QAAQ,OAAO,GAAG,CAAC,CAAC;AAAA,IAC1D;AACA,YAAQ,IAAI,aAAa,SAAS;AAAA,EACtC;AACJ;;;AClBO,IAAM,kBAAqC;AAAA,EAC9C,IAAI,QAAQ,KAAK,UAAU;AACvB,QAAI,QAAQ,oCAA2B;AACnC,aAAO;AAAA,IACX;AACA,UAAM,QAAQ,GAAG;AAEjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC5C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAE9B,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACnD;AACJ;;;AClBA,IAAM,cAAc,oBAAI,QAAQ;AAEzB,SAAS,SAAS,QAAgB;AACrC,SAAO,qBAAqB,MAAM;AACtC;AAEA,SAAS,qBAAqB,QAAgB;AAE1C,MAAI,CAAC,SAAS,MAAM,GAAG;AACnB,WAAO;AAAA,EACX;AAEA,MAAI,yCAAgC,GAAG;AACnC,WAAO;AAAA,EACX;AACA,QAAM,aAAa,YAAY,IAAI,MAAM;AACzC,MAAI,YAAY;AACZ,WAAO;AAAA,EACX;AACA,MAAI,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAC7C,cAAY,IAAI,QAAQ,KAAK;AAC7B,SAAO;AACX;",
  "names": []
}
